<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Landing Page</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; background:#0b1220; color:#e5e7eb; margin:0; padding:24px;}
    .wrap{max-width:860px; margin:0 auto;}
    h1{margin:0 0 8px; font-size:34px;}
    p{margin:0 0 18px; color:#cbd5e1}
    .card{background:#0f172a; border:1px solid #1f2a44; border-radius:14px; padding:18px;}
    .row{display:flex; gap:12px; flex-wrap:wrap;}
    .col{flex:1; min-width:240px;}
    label{display:block; margin:10px 0 6px; color:#cbd5e1; font-size:14px;}
    input,textarea{
      width:100%; box-sizing:border-box;
      padding:12px 12px;
      border-radius:10px;
      border:1px solid #26324f;
      background:#0b1220;
      color:#e5e7eb;
      outline:none;
    }
    textarea{min-height:120px; resize:vertical;}
    input:focus,textarea:focus{border-color:#3b82f6;}
    .btn{
      margin-top:14px;
      padding:12px 16px;
      border:0;
      border-radius:12px;
      background:#38bdf8;
      color:#001018;
      font-weight:700;
      cursor:pointer;
    }
    .btn:disabled{opacity:.55; cursor:not-allowed;}
    .msg{margin-top:12px; padding:12px; border-radius:12px; display:none;}
    .ok{background:#052e1a; border:1px solid #14532d; color:#bbf7d0;}
    .err{background:#3b0a0a; border:1px solid #7f1d1d; color:#fecaca;}
    .hint{margin-top:10px; font-size:12px; color:#94a3b8;}
    code{background:#0b1220; border:1px solid #26324f; padding:2px 6px; border-radius:8px; color:#e2e8f0;}
  </style>
</head>

<body>
  <div class="wrap">
    <h1>Landing Page</h1>
    <p>عمر المعلومات وارسِلها لـ n8n مباشرة.</p>

    <div class="card">
      <form id="leadForm">
        <div class="row">
          <div class="col">
            <label for="name">الاسم</label>
            <input id="name" name="name" placeholder="مثال: Mouad" required />
          </div>

          <div class="col">
            <label for="phone">الهاتف / WhatsApp</label>
            <input id="phone" name="phone" placeholder="+212..." required />
          </div>
        </div>

        <label for="email">الإيميل (اختياري)</label>
        <input id="email" name="email" placeholder="you@email.com" />

        <label for="message">رسالة (اختياري)</label>
        <textarea id="message" name="message" placeholder="شنو بغيتي؟"></textarea>

        <button class="btn" id="btn" type="submit">إرسال</button>

        <div id="msgBox" class="msg"></div>
        <div class="hint">
          مهم: خاص <b>WEBHOOK_URL</b> يكون Production ديال n8n عبر Cloudflare Tunnel.
        </div>
      </form>
    </div>
  </div>

  <script>
    // ✅ حط هنا رابط Cloudflare ديالك اللي كيدخل لـ n8n production webhook
    const WEBHOOK_URL = "https://printing-lucky-dash-frequency.trycloudflare.com/webhook/landing";

    const form = document.getElementById("leadForm");
    const btn = document.getElementById("btn");
    const msgBox = document.getElementById("msgBox");

    function showMsg(text, ok=true){
      msgBox.style.display = "block";
      msgBox.className = "msg " + (ok ? "ok" : "err");
      msgBox.textContent = text;
    }

    function normalizePhone(v){
      return (v || "").toString().trim();
    }

    function clean(v){
      return (v || "").toString().trim();
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      // Basic checks
      if (!WEBHOOK_URL || !/^https?:\/\//i.test(WEBHOOK_URL)) {
        showMsg("WEBHOOK_URL غير صحيح. رجّع للكود وحط الرابط الصحيح.", false);
        return;
      }

      const data = {
        name: clean(form.name.value),
        phone: normalizePhone(form.phone.value),
        email: clean(form.email.value),
        message: clean(form.message.value),
        page: location.href,
        ts: new Date().toISOString()
      };

      if (!data.name || !data.phone) {
        showMsg("الاسم والهاتف ضروريين.", false);
        return;
      }

      btn.disabled = true;
      btn.textContent = "Sending...";

      try {
        const res = await fetch(WEBHOOK_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
          // مهم: كيخلي المتصفح يتقبل رد حتى إلا كان بسيط
          mode: "cors",
        });

        // بعض الأحيان n8n كيرد بـ 204 بلا body
        if (!res.ok) {
          const txt = await res.text().catch(() => "");
          showMsg("فشل الإرسال: HTTP " + res.status + (txt ? " | " + txt.slice(0,120) : ""), false);
          return;
        }

        let payload = null;
        try { payload = await res.json(); } catch(_) {}

        showMsg("✅ تم الإرسال بنجاح");
        form.reset();

      } catch (err) {
        // غالباً CORS/Tunnel down/URL غلط
        showMsg("فشل الإرسال: Failed to fetch (تأكد أن Cloudflare شغال و n8n شغال و الرابط صحيح)", false);
      } finally {
        btn.disabled = false;
        btn.textContent = "إرسال";
      }
    });
  </script>
</body>
</html>
